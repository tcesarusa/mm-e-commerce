/*
@license
Webix Kanban v.4.1.0
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="/codebase/",e(0)}([function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};i(2),webix.protoUI({name:"kanban",defaults:{listFilter:function(t,e){var i=e.config.status,s=!0;if("function"==typeof e.config.status)s=e.config.status.call(e,t);else if("object"==n(e.config.status))for(var a in i)s=s&&t[a]==i[a];else s=t.status==e.config.status;return s}},$init:function(){this.data.provideApi(this,!0),this._applyOrder(),this.$ready.push(function(){this._sublist=this._buildSublistMap(this,{})})},_applyOrder:function(){var t=this;this.data.attachEvent("onStoreUpdated",function(e,i,n){var s,a,o,r={},c=null;if("update"==n||"add"==n)for(o=this.getRange(),c=null,a=0;!c&&a<o.length;a++)i.status!=o[a].status||webix.isUndefined(i.$index)||i.$index!=o[a].$index||(c=o[a],this.blockEvent(),this.move(this.getIndexById(e),this.getIndexById(c.id)),this.unblockEvent());if(!e){var l=webix.copy(this.order),h=this;l.sort(function(t,e){var i=h.getItem(t),n=h.getItem(e);return t=i.$index,e=n.$index,t==e&&webix.isUndefined(t)?(t=h.order.indexOf(i.id),e=h.order.indexOf(n.id),t>e?1:e>t?-1:0):t>e?1:e>t?-1:0}),this.order=l}this.each(function(t){t.status&&(r[t.status]||(r[t.status]=[]),r[t.status].push(t))});for(var u in r)for(s=r[u],t._sortItems(s,"update"==n||"add"==n?e:null),a=0;a<s.length;a++)s[a].$index=a})},_sortItems:function(t,e){for(var i=0;i<t.length;i++)t[i].$i=i;t.sort(function(t,i){var n=t.$index,s=i.$index,a=n>s?1:s>n?-1:0;return a||!e||webix.isUndefined(n)||webix.isUndefined(s)?a||(t.$i>i.$i?1:-1):t.id==e?-1:1})},setIndex:function(t,e){var i,n;n=this.getOwnerList(t),i=n.count(),(e>i-1||-1==e)&&(e=i?i-1:0),this.getItem(t).$index=e,e=this._getIndex(n,e),this.data.silent(function(){this.move(this.getIndexById(t),e)}),this.refresh(t)},_buildSublistMap:function(t,e){for(var i=t.getChildViews(),n=0;n<i.length;n++){var s=i[n];if(s.$kanban){var a=s.config.status;e[a]?(webix.isArray(e[a])||(e[a]=[e[a]]),e[a].push(s)):e[a]=s,this.config.icons&&(s.type.icons=this.config.icons),s.config.master=this.config.id,s.sync(this.data,this._getSublistFilter)}else s.getChildViews&&this._buildSublistMap(s,e)}return e},_getSublistFilter:function(){var t=webix.$$(this.owner),e=webix.$$(t.config.master);this.filter(function(i){return e.config.listFilter.call(e,i,t)}),t.sort(function(t,e){return t=t.$index,e=e.$index,t>e?1:e>t?-1:0})},getSelectedId:function(){var t=null;return this.eachList(function(e){t=e.getSelectedId()||t}),t},select:function(t){this.getOwnerList(t).select(t)},getOwnerList:function(t){var e=null;return this.eachList(function(i){i.data.order.find(t)>-1&&(e=i)}),e},eachList:function(t){for(var e in this._sublist)if(webix.isArray(this._sublist[e]))for(var i=0;i<this._sublist[e].length;i++)t.call(this,webix.$$(this._sublist[e][i]),e);else t.call(this,webix.$$(this._sublist[e]),e)},_getIndex:function(t,e){var i=-1,n=t.getIdByIndex(e);if(n)i=this.getIndexById(n);else{var s=[];for(var a in this._sublist){if(this._sublist[a]==t){for(var o=s.length-1;0>i&&o>=0;o--)s[o].count()&&(i=this.getIndexById(s[o].getLastId()));0>i&&(i=0)}s.push(this._sublist[a])}}return i},_unmarkList:function(){if(this._markedListId){var t=webix.$$(this._markedListId);webix.html.removeCss(t.$view,"webix_drag_over")}},_markList:function(t){this._unmarkList(),t.$view.className.indexOf("webix_drag_over")<0&&(webix.html.addCss(t.$view,"webix_drag_over"),this._markedListId=t.config.id)}},webix.DataLoader,webix.EventSystem,webix.ui.headerlayout),webix.protoUI({name:"kanbanlist",$init:function(){this.$view.className+=" webix_kanban_list",this.attachEvent("onAfterSelect",function(){this.eachOtherList(function(t){t.unselect()})}),this.$ready.push(webix.bind(this._setHandlers,this))},$kanban:!0,on_context:{},$dragDestroy:function(){webix.$$(this.config.master)._unmarkList(),webix.html.remove(webix.DragControl.getNode())},_setHandlers:function(){this.on_click.webix_kanban_user_avatar=function(t,e,i){return webix.$$(this.config.master).callEvent("onAvatarClick",[e,t,i,this])},this.attachEvent("onBeforeSelect",function(t,e){return webix.$$(this.config.master).callEvent("onListBeforeSelect",[t,e,this])}),this.attachEvent("onAfterSelect",function(t){webix.$$(this.config.master).callEvent("onListAfterSelect",[t,this])}),this.attachEvent("onItemClick",function(t,e,i){for(var n=e.target||e.srcElement,s=null;!s&&n!=i;)s=n.getAttribute("webix_icon_id"),n=n.parentNode;var a=!0;s&&(a=a&&webix.$$(this.config.master).callEvent("onListIconClick",[s,t,e,i,this])),a&&webix.$$(this.config.master).callEvent("onListItemClick",[t,e,i,this])}),this.attachEvent("onItemDblClick",function(t,e,i){webix.$$(this.config.master).callEvent("onListItemDblClick",[t,e,i,this])}),this.attachEvent("onBeforeContextMenu",function(t,e,i){return webix.$$(this.config.master).callEvent("onListBeforeContextMenu",[t,e,i,this])}),this.attachEvent("onAfterContextMenu",function(t,e,i){webix.$$(this.config.master).callEvent("onListAfterContextMenu",[t,e,i,this])}),this.attachEvent("onBeforeDrag",function(t,e){return webix.$$(this.config.master).callEvent("onListBeforeDrag",[t,e,this])}),this.attachEvent("onBeforeDragIn",function(t,e){var i=webix.$$(this.config.master),n=i.callEvent("onListBeforeDragIn",[t,e,this]);return i._unmarkList(),n&&(t.target||i._markList(this)),n}),this.attachEvent("onDragOut",function(t,e){webix.$$(this.config.master).callEvent("onListDragOut",[t,e,this])}),this.dropHandler=this.attachEvent("onBeforeDrop",function(t,e){var i,s,a,o,r,c=webix.$$(this.config.master);if(c._unmarkList(),c.callEvent("onListBeforeDrop",[t,e,this])){for(a=t.source,r=t.from==t.to,i=0;i<a.length;i++){s=a[i],o=c.getItem(s);var l=t.index;if(t.target||(l=this.count()?this.count()-1:0),o.$index=l,c.data.blockEvent(),l=c._getIndex(this,l),r||(t.target&&l&&l>c.getIndexById(s)&&l--,!t.target&&this.count()&&l<c.getIndexById(s)&&l++),c.data.move(c.getIndexById(s),l),c.data.unblockEvent(),!r&&c.callEvent("onBeforeStatusChange",[s,this.config.status,this,t,e])){var h=this.config.status;if("object"==("undefined"==typeof h?"undefined":n(h)))for(var u in h)o[u]=h[u];else o.status=h;c.refresh(s),c.callEvent("onAfterStatusChange",[s,this.config.status,this,t,e])}}if(r)for(i=0;i<a.length;i++)c.refresh(a[i]);c.callEvent("onListAfterDrop",[t,e,this])}return!1})},$dragCreate:function(t,e){var i=webix.DragControl.$drag(t,e);if(!i)return!1;var n=document.createElement("DIV");return n.innerHTML=i,n.className="webix_drag_zone webix_kanban_drag_zone",document.body.appendChild(n),n},$dragPos:function(t){t.x=t.x-4,t.y=t.y-4},eachOtherList:function(t){var e=this.config.id,i=webix.$$(this.config.master);i.eachList(function(i){i.config.id!=e&&t.call(webix.$$(e),i)})},type_setter:function(t){var e=0,i=null,n=webix.ui.dataview.prototype.type_setter.apply(this,arguments);if(this.type.icons)for(e=0;e<this.type.icons.length;e++)i=this.type.icons[e],i.click&&(this.on_click["fa-"+i.icon]=i.click);return n},defaults:{drag:!0,prerender:!0,select:!0,xCount:1},type:{height:"auto",width:"auto",icons:[{icon:"pencil"}],tagDemiliter:",",templateTags:function(t,e){var i=[];if(t.tags)for(var n=t.tags.split(e.tagDemiliter),s=0;s<n.length;s++)i.push('<span class="webix_kanban_tag">'+n[s]+"</span>");return'<div  class="webix_kanban_tags">'+(i.length?i.join(" "):"&nbsp;")+"</div>"},templateIcons:function(t,e){for(var i=[],n=null,s="",a=0;a<e.icons.length;a++)n=e.icons[a],n.show&&!n.show(t)||(s='<span webix_icon_id="'+(n.id||n.icon)+'" class="webix_kanban_icon" title="'+(n.tooltip||"")+'">',s+='<span class="fa-'+n.icon+' webix_icon"></span>',n.template&&(s+='<span class="webix_kanban_icon_text">'+webix.template(n.template)(t)+"</span>"),s+="</span>",i.push(s));return'<div  class="webix_kanban_icons">'+i.join(" ")+"</div>"},templateNoAvatar:webix.template("<span class='webix_icon fa-user'></span>"),templateAvatar:webix.template(""),templateBody:webix.template("#text#"),templateFooter:function(t,e){var i=e.templateTags(t,e);return(i?i:"&nbsp;")+e.templateIcons(t,e)},templateStart:webix.template('<div webix_f_id="#id#" class="{common.classname()} webix_kanban_list_item" style="width:{common.width}px; height:{common.height}px;   overflow:hidden;float:left;">'),template:function(t,e){var i=e.templateAvatar(t,e),n='<div class="webix_kanban_user_avatar">'+(i?i:e.templateNoAvatar(t,e))+"</div>",s='<div class="webix_kanban_body">'+e.templateBody(t,e)+"</div>",a='<div class="webix_kanban_footer">'+e.templateFooter.call(this,t,e)+"</div>",o="border-left-color:"+t.color;return n+'<div class="webix_kanban_list_content" style="'+o+'">'+s+a+"</div>"}}},webix.ui.dataview)},,function(t,e){"use strict"}]);